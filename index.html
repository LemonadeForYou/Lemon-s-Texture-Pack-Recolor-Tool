<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üçã Lemon's Texture Pack Recolor Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Orbitron', sans-serif;
  background: linear-gradient(135deg, #0b0f1f, #05070f);
  color: #ffffcc;
  margin: 0;
  padding: 20px;
}

h1 {
  text-align: center;
  color: #fffacd;
  text-shadow: 0 0 15px #ffff66, 0 0 30px #ffea00;
}

.container {
  max-width: 1300px;
  margin: auto;
  background: rgba(10,10,30,0.92);
  padding: 25px;
  border-radius: 22px;
  border: 2px solid #ffea00;
  box-shadow: 0 0 35px rgba(255,255,102,0.35);
}

.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  margin-bottom: 15px;
}

input, button {
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid #ffff66;
  background: rgba(255,255,102,0.12);
  color: #ffffcc;
  font-weight: bold;
  transition: 0.2s;
}

input[type="color"] {
  width: 42px;
  height: 42px;
  padding: 3px;
}

button:hover, input:hover {
  background: rgba(255,255,102,0.25);
  box-shadow: 0 0 12px rgba(255,255,102,0.6);
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 14px;
}

.item {
  background: rgba(0,0,0,0.35);
  border: 1px solid #ffff66;
  border-radius: 14px;
  padding: 8px;
  position: relative;
}

.item img {
  width: 100%;
  image-rendering: pixelated;
  border-radius: 8px;
  border: 1px solid #ffea00;
}

.filename {
  font-size: 11px;
  margin-top: 5px;
  word-break: break-all;
}

.checkbox {
  position: absolute;
  top: 6px;
  left: 6px;
  transform: scale(1.2);
  accent-color: #ffea00;
}
</style>
</head>

<body>
<h1>üçã Lemon's Texture Pack Recolor Tool</h1>

<div class="container">
  <div class="controls">
    <input type="file" id="fileInput" accept=".zip,.mcpack">
    <input type="color" id="colorPicker" value="#ffea00">
    <input type="text" id="hexInput" value="#ffea00">
    <button id="selectAll">Select All</button>
    <button id="deselectAll">Deselect All</button>
    <button id="recolor">Recolor</button>
  </div>

  <div class="grid" id="grid"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<script>
const fileInput = document.getElementById('fileInput');
const colorPicker = document.getElementById('colorPicker');
const hexInput = document.getElementById('hexInput');
const grid = document.getElementById('grid');

let textures = [];

colorPicker.oninput = () => hexInput.value = colorPicker.value;
hexInput.oninput = () => {
  if(/^#?[0-9a-fA-F]{6}$/.test(hexInput.value)){
    colorPicker.value = hexInput.value.startsWith('#') ? hexInput.value : '#'+hexInput.value;
  }
};

fileInput.addEventListener('change', async () => {
  grid.innerHTML = '';
  textures = [];

  const zip = await JSZip.loadAsync(fileInput.files[0]);
  const entries = Object.values(zip.files).filter(f => f.name.endsWith('.png'));

  const fragment = document.createDocumentFragment();

  for (const entry of entries) {
    const blob = await entry.async('blob');
    const bitmap = await createImageBitmap(blob);

    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = bitmap.width;
    canvas.height = bitmap.height;
    ctx.drawImage(bitmap,0,0);

    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    textures.push({ imageData });

    fragment.appendChild(createItem(canvas.toDataURL(), entry.name));
    await new Promise(r => requestAnimationFrame(r)); // smooth
  }

  grid.appendChild(fragment);
});

function createItem(src, name){
  const div = document.createElement('div');
  div.className = 'item';

  const cb = document.createElement('input');
  cb.type = 'checkbox';
  cb.checked = true;
  cb.className = 'checkbox';

  const img = document.createElement('img');
  img.loading = 'lazy';
  img.src = src;

  const label = document.createElement('div');
  label.className = 'filename';
  label.textContent = name;

  div.append(cb, img, label);
  return div;
}

document.getElementById('recolor').onclick = () => {
  const rgb = hexToRgb(colorPicker.value);
  document.querySelectorAll('.item').forEach((item,i)=>{
    if(!item.querySelector('.checkbox').checked) return;

    const srcData = textures[i].imageData;
    const data = new ImageData(
      new Uint8ClampedArray(srcData.data),
      srcData.width,
      srcData.height
    );

    for(let p=0;p<data.data.length;p+=4){
      const b=(data.data[p]+data.data[p+1]+data.data[p+2])/3/255;
      data.data[p]=rgb.r*b;
      data.data[p+1]=rgb.g*b;
      data.data[p+2]=rgb.b*b;
    }

    const c=document.createElement('canvas');
    c.width=data.width;
    c.height=data.height;
    c.getContext('2d').putImageData(data,0,0);
    item.querySelector('img').src=c.toDataURL();
  });
};

document.getElementById('selectAll').onclick = () =>
  document.querySelectorAll('.checkbox').forEach(c=>c.checked=true);

document.getElementById('deselectAll').onclick = () =>
  document.querySelectorAll('.checkbox').forEach(c=>c.checked=false);

function hexToRgb(hex){
  hex=hex.replace('#','');
  const n=parseInt(hex,16);
  return {r:(n>>16)&255,g:(n>>8)&255,b:n&255};
}
</script>
</body>
</html>